---
title: "temp_anomaly"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## 온도 이상치 탐지
- 시계열 이상 탐지
- 온도 데이터의 이상치 탐색
- 센서 오류로 인한 이상치 탐지
- 평소보다 덥거나 추운곳 탐지


```{r}
# 패키지 불러오기
library(tidyverse)
library(tibbletime)
library(anomalize)
```



```{r cars}
# 경로 설정
setwd("/cloud/project/R_code/temp_anomaly")

# 데이터 불러오기
raw_df <- read.csv2(file="temp_tag_temp_sample_210803.csv", sep=",")
str(raw_df)

# 데이터 형변환
df <- raw_df
df$reg_dt <- as.POSIXct(df$reg_dt)

df <- as_tbl_time(df, index = reg_dt)
df <- df %>% group_by(spce_id)


```


# 이상 탐지
```{r}
# anomalized 
df_anomalized <- df %>%
  time_decompose(tag_value, merge=TRUE) %>%
  anomalize(remainder,alpha = 0.05, max_anoms = 0.2) %>%
  time_recompose()

df_anomalized %>% glimpse()


# plot 
plot <- df_anomalized %>% 
  plot_anomalies(time_recomposed = TRUE, ncol=3, alpha_dots = 0.05) + ggtitle("alpha = 0.05")

plot

```


